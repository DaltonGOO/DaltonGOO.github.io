<!doctype html><html lang=en><head><meta charset=utf-8><title>MyBlog</title><link href=https://daltongoo.github.io/style.css rel=stylesheet><style>#progress-bar{position:fixed;top:0;left:0;height:3px;width:0;z-index:999;background:currentColor}.title-underline{display:block;height:2px;width:0;background:currentColor;margin:.5rem 0 1.25rem}.word{display:inline-block;will-change:transform,opacity}</style><body><section class=section><div class=container><h1>Revit MEP Agent</h1><div class=portfolio-detail><p>The <strong>Revit MEP Agent</strong> is a local event-driven system I built to bridge Revit and external computation layers.<br> It’s not a chatbot or automation script — it’s a deterministic agent that observes, interprets, and reacts to model data in real time across multiple MEP disciplines.</p><span id=continue-reading></span><hr><h2 id=overview>Overview</h2><p>The goal was to move beyond one-off automations and instead create a framework that could:<ul><li>Monitor model state changes<li>Exchange structured data (DTOs) with a backend (This allows for information to be passed cleanly between Revit and other systems and isn’t exposed to the LLM directly)<li>Run heavy logic outside of Revit (Rust or Python)<li>Log and test everything deterministically</ul><p>This became a foundation for how I approach automation across mechanical, electrical, and plumbing workflows.<p><img alt="Simple Architecture Diagram of Revit MEP Agent" src=/images/portfolio/revit-mep-agent/simple-architecture-diagram.png><hr><h2 id=core-features>Core Features</h2><h3 id=user-driven-agent>User-Driven Agent</h3><p>The agent is built around an event loop that listens for user actions and model changes.<br> When triggered, it packages up relevant data into DTOs and sends them to a backend service for processing.<hr><h3 id=data-transfer-objects-dtos>Data Transfer Objects (DTOs)</h3><p>All communication uses <strong>DTOs</strong> to serialize and deserialize model data cleanly.<br> Each DTO defines exactly what data a command expects and returns.<p>Example:<ul><li><code>ElementDataDto</code> — geometry and parameter metadata<li><code>CommandRequestDto</code> — structured command sent to the agent<li><code>CommandResponseDto</code> — deterministic result returned to Revit</ul><pre class=language-csharp data-lang=csharp style=background:#2b303b;color:#c0c5ce><code class=language-csharp data-lang=csharp><span>public class ElementDataDto
</span><span>{
</span><span>    public int ElementId { get; set; }
</span><span>    public string Category { get; set; }
</span><span>    public Dictionary&LTstring, string> Parameters { get; set; }
</span><span>    public GeometryDataDto Geometry { get; set; }
</span><span>}
</span><span>
</span><span>public class CommandRequestDto
</span><span>{
</span><span>    public string CommandType { get; set; }
</span><span>    public List&LTElementDataDto> Elements { get; set; }
</span><span>}
</span></code></pre><hr><h3 id=custom-logging>Custom Logging</h3><p>Every part of the system uses a shared logging utility.<br> The logger is lightweight, file-based, and consistent. So, whether a function is running inside Revit or on the server, or in the router, all logs align.<p>It includes:<ul><li>Function tracing<li>Timestamped output<li>Log rotation<li>A Revit button that opens the active log instantly</ul><pre class=language-text data-lang=text style=background:#2b303b;color:#c0c5ce><code class=language-text data-lang=text><span>[2024-10-25 14:32:10] [INFO] CommandRequestDto received with 5 elements.
</span><span>[2024-10-25 14:32:11] [DEBUG-REVIT] Processing ElementId 12345: Category=Air Terminal
</span><span>[2024-10-25 14:32:12] [ERROR-REVIT] Parameter "Flow" missing on ElementId 12346
</span></code></pre><hr><h3 id=fake-server-for-testing>Fake Server for Testing</h3><p>I built a <strong>mock Revit Agent server</strong> in Jupyter Notebook to test DTOs, socket behavior, handlers, and error handling inside of Revi0t.<br> This fake server can send simulated JSON commands. Perfect for debugging without needing a live connection to Claud.<pre class=language-python data-lang=python style=background:#2b303b;color:#c0c5ce><code class=language-python data-lang=python><span style=color:#65737e># mcp_server.py
</span><span style=color:#b48ead>import </span><span>socket
</span><span style=color:#b48ead>import </span><span>threading
</span><span>
</span><span style=color:#bf616a>HOST </span><span>= "</span><span style=color:#a3be8c>127.0.0.1</span><span>"   
</span><span style=color:#bf616a>PORT </span><span>= </span><span style=color:#d08770>5577
</span><span>
</span><span style=color:#b48ead>def </span><span style=color:#8fa1b3>input_loop</span><span>(</span><span style=color:#bf616a>conn</span><span>):
</span><span>    </span><span style=color:#65737e>"""Background thread to type messages to send to Revit."""
</span><span>    </span><span style=color:#b48ead>try</span><span>:
</span><span>        </span><span style=color:#b48ead>while </span><span style=color:#d08770>True</span><span>:
</span><span>            msg = </span><span style=color:#96b5b4>input</span><span>("</span><span style=color:#a3be8c>Enter JSON to send to Revit (or 'quit' to stop): </span><span>")
</span><span>            </span><span style=color:#b48ead>if </span><span>msg.</span><span style=color:#bf616a>strip</span><span>().</span><span style=color:#bf616a>lower</span><span>() in {"</span><span style=color:#a3be8c>quit</span><span>", "</span><span style=color:#a3be8c>exit</span><span>"}:
</span><span>                </span><span style=color:#b48ead>break
</span><span>            </span><span style=color:#b48ead>if </span><span>not msg.</span><span style=color:#bf616a>endswith</span><span>("</span><span style=color:#96b5b4>\n</span><span>"):
</span><span>                msg += "</span><span style=color:#96b5b4>\n</span><span>"
</span><span>            conn.</span><span style=color:#bf616a>sendall</span><span>(msg.</span><span style=color:#bf616a>encode</span><span>("</span><span style=color:#a3be8c>utf-8</span><span>"))
</span><span>    </span><span style=color:#b48ead>except </span><span>Exception </span><span style=color:#b48ead>as </span><span>e:
</span><span>        </span><span style=color:#96b5b4>print</span><span>("</span><span style=color:#a3be8c>Input loop ended:</span><span>", e)
</span><span>       
</span><span style=color:#65737e># Main server loop      
</span><span style=color:#b48ead>while </span><span style=color:#d08770>True</span><span>:  
</span><span>    </span><span style=color:#b48ead>with </span><span>socket.</span><span style=color:#bf616a>socket</span><span>(socket.</span><span style=color:#bf616a>AF_INET</span><span>, socket.</span><span style=color:#bf616a>SOCK_STREAM</span><span>) </span><span style=color:#b48ead>as </span><span>s:
</span><span>        s.</span><span style=color:#bf616a>setsockopt</span><span>(socket.</span><span style=color:#bf616a>SOL_SOCKET</span><span>, socket.</span><span style=color:#bf616a>SO_REUSEADDR</span><span>, </span><span style=color:#d08770>1</span><span>)
</span><span>        s.</span><span style=color:#bf616a>bind</span><span>((</span><span style=color:#bf616a>HOST</span><span>, </span><span style=color:#bf616a>PORT</span><span>))
</span><span>        s.</span><span style=color:#bf616a>listen</span><span>(</span><span style=color:#d08770>1</span><span>)
</span><span>        </span><span style=color:#96b5b4>print</span><span>(</span><span style=color:#b48ead>f</span><span>"</span><span style=color:#a3be8c>Listening on </span><span>{</span><span style=color:#bf616a>HOST</span><span>}</span><span style=color:#a3be8c>:</span><span>{</span><span style=color:#bf616a>PORT</span><span>}</span><span style=color:#a3be8c> ...</span><span>")
</span><span>        conn, addr = s.</span><span style=color:#bf616a>accept</span><span>()
</span><span>        </span><span style=color:#b48ead>with </span><span>conn:
</span><span>            </span><span style=color:#96b5b4>print</span><span>("</span><span style=color:#a3be8c>Connected by</span><span>", addr)
</span><span>
</span><span>            </span><span style=color:#65737e># Send something to Revit
</span><span>            conn.</span><span style=color:#bf616a>sendall</span><span>(</span><span style=color:#b48ead>b</span><span>'</span><span style=color:#a3be8c>{"type":"hello","from":"python"}</span><span style=color:#96b5b4>\n</span><span>')
</span><span>
</span><span>            </span><span style=color:#65737e># Start a thread. Can type into the console and send messages to Revit
</span><span>            threading.</span><span style=color:#bf616a>Thread</span><span>(</span><span style=color:#bf616a>target</span><span>=input_loop, </span><span style=color:#bf616a>args</span><span>=(conn,), </span><span style=color:#bf616a>daemon</span><span>=</span><span style=color:#d08770>True</span><span>).</span><span style=color:#bf616a>start</span><span>()
</span><span>
</span><span>            buf = </span><span style=color:#b48ead>b</span><span>""
</span><span>            </span><span style=color:#b48ead>while </span><span style=color:#d08770>True</span><span>:
</span><span>                </span><span style=color:#b48ead>try</span><span>:
</span><span>                    data = conn.</span><span style=color:#bf616a>recv</span><span>(</span><span style=color:#d08770>4096</span><span>)
</span><span>                    </span><span style=color:#b48ead>if </span><span>not data:
</span><span>                        </span><span style=color:#96b5b4>print</span><span>("</span><span style=color:#a3be8c>Client closed.</span><span>")
</span><span>                        </span><span style=color:#b48ead>break
</span><span>                    buf += data
</span><span>                    </span><span style=color:#b48ead>while b</span><span>"</span><span style=color:#96b5b4>\n</span><span>" in buf:
</span><span>                        line, buf = buf.</span><span style=color:#bf616a>split</span><span>(</span><span style=color:#b48ead>b</span><span>"</span><span style=color:#96b5b4>\n</span><span>", </span><span style=color:#d08770>1</span><span>)
</span><span>                        txt = line.</span><span style=color:#bf616a>decode</span><span>("</span><span style=color:#a3be8c>utf-8</span><span>", </span><span style=color:#bf616a>errors</span><span>="</span><span style=color:#a3be8c>replace</span><span>")
</span><span>                        </span><span style=color:#96b5b4>print</span><span>("</span><span style=color:#a3be8c>Got from Revit:</span><span>", txt, </span><span style=color:#bf616a>flush</span><span>=</span><span style=color:#d08770>True</span><span>)
</span><span>                        </span><span style=color:#65737e># Respond automatically with a pong
</span><span>                        conn.</span><span style=color:#bf616a>sendall</span><span>(</span><span style=color:#b48ead>b</span><span>'</span><span style=color:#a3be8c>{"type":"info","msg":"pong from python"}</span><span style=color:#96b5b4>\n</span><span>')
</span><span>                </span><span style=color:#b48ead>except </span><span>ConnectionResetError </span><span style=color:#b48ead>as </span><span>e:
</span><span>                    </span><span style=color:#96b5b4>print</span><span>("</span><span style=color:#a3be8c>Connection reset:</span><span>", e)
</span><span>                    </span><span style=color:#b48ead>break
</span></code></pre><hr><h3 id=shared-utilities>Shared Utilities</h3><p>The agent ties into a growing library of cross-discipline utilities:<ul><li>Parameter helpers (get/set with type safety)<li>Smart tagging system for clean tag placement (N, S, E, W)<li>Linked element utilities for view templates and references</ul><p>Each module can run standalone or plug into the agent, giving flexibility for future projects.<hr><h2 id=mep-integration>MEP Integration</h2><p>The Revit MEP Agent is modular across disciplines:<ul><li><strong>Mechanical:</strong> air terminal and duct validation<li><strong>Electrical:</strong> circuit and load analysis<li><strong>Plumbing:</strong> slope and connector consistency checks<li><strong>Architectural:</strong> basic link coordination</ul><p>Each runs through the same DTO and logging backbone, allowing consistent metrics and testable results.<hr><h2 id=why-it-matters>Why It Matters</h2><p>This project represents how I think about AEC automation — not as a bunch of scripts, but as a <strong>system</strong> that captures reasoning and relationships.<br> Every component — from DTOs to the fake server — was built to make logic testable, transparent, and extendable.<p>It’s a foundation for future agent-based work, where Revit isn’t just a modeler but an intelligent, observable system.<hr><p><strong>Tech Stack:</strong><br> <code>C#</code>, <code>Python 3</code>, <code>SQLite</code>, <code>Socket</code>, <code>Jupyter Notebook</code><hr></div></div></section><script src=/vendor/anime/anime.umd.min.js></script><script>const {animate,stagger}=anime;const prefersReduced=window.matchMedia('(prefers-reduced-motion: reduce)').matches;function splitWords(a){if(!a)return [];const b=(a.textContent||'').trim().split(/\s+/);a.textContent='';return b.map(c=>{const d=document.createElement('span');d.className='word';d.textContent=c+ ' ';a.appendChild(d);return d})}function heroReveal(){const a=document.querySelector('#hero-title');if(!a)return;if(prefersReduced){a.style.opacity=1;return};const b=splitWords(a);animate(b,{opacity:[0,1],translateY:[12,0]},{duration:500,delay:(c,d)=>d*45,easing:'easeOutCubic'})}function titleUnderline(){const a=document.querySelector('.title-underline');if(!a)return;if(prefersReduced){a.style.width='100%';return};animate(a,{width:['0%','100%']},{duration:650,easing:'easeOutCubic'})}function readingProgress(){let a=document.getElementById('progress-bar');if(!a){a=document.createElement('div');a.id='progress-bar';document.body.appendChild(a)};const b=()=>{const c=document.documentElement.scrollHeight- window.innerHeight;const d=c>0?(window.scrollY/c)*100:0;if(prefersReduced){a.style.width=d+ '%';return};animate(a,{width:d+ '%'},{duration:120,easing:'linear'})};b();window.addEventListener('scroll',b,{passive:true});window.addEventListener('resize',b)}function initPulse(){const a=document.querySelectorAll('#pulse span');if(a.length===0)return;if(prefersReduced){a.forEach(b=>b.style.opacity=1);return};animate(a,{opacity:[0.2,1],scale:[1,1.4]},{delay:stagger(250,{direction:'alternate'}),duration:700,easing:'easeInOutSine',loop:true,direction:'alternate'})}document.addEventListener('DOMContentLoaded',()=>{heroReveal();titleUnderline();readingProgress();initPulse()})</script><script src=https://daltongoo.github.io/js/app.js></script>